import React, { useState, useEffect } from 'react';
import { cn } from '@/lib/utils';

interface Word {
  korean: string;
  spanish: string;
}

const words: Word[] = [
  { korean: "Ïßë", spanish: "casa" },
  { korean: "Í∞ÄÏ†ï", spanish: "hogar" },
  { korean: "Î∞©", spanish: "habitaci√≥n" },
  { korean: "Í±∞Ïã§", spanish: "comedor" },
  { korean: "Ï£ºÎ∞©", spanish: "cocina" },
  { korean: "ÌôîÏû•Ïã§", spanish: "ba√±o" },
  { korean: "Ïπ®Ïã§", spanish: "dormitorio" },
  { korean: "ÏöïÏã§", spanish: "ba√±o (donde hay ba√±era)" },
  { korean: "ÌòÑÍ¥Ä", spanish: "entrada para los zapatos" },
  { korean: "Îã§ÎùΩÎ∞©", spanish: "√°tico" },
  { korean: "ÏßÄÌïòÏã§", spanish: "s√≥tano" },
  { korean: "ÎßàÎãπ", spanish: "patio exterior (antes de entrar a la casa)" },
  { korean: "Ï†ïÏõê", spanish: "jard√≠n" },
  { korean: "Ï∞ΩÎ¨∏", spanish: "ventana" },
  { korean: "Î¨∏", spanish: "puerta" },
  { korean: "Ï≤úÏû•", spanish: "techo (por dentro)" },
  { korean: "Î∞îÎã•", spanish: "suelo" },
  { korean: "Î≤Ω", spanish: "pared" },
  { korean: "Í∞ÄÍµ¨", spanish: "mueble" },
  { korean: "ÏÜåÌåå", spanish: "sof√°" },
  { korean: "ÌÖåÏù¥Î∏î", spanish: "mesa" },
  { korean: "ÏùòÏûê", spanish: "silla" },
  { korean: "Ïπ®ÎåÄ", spanish: "cama" },
  { korean: "Ïò∑Ïû•", spanish: "armario" },
  { korean: "ÏÑúÎûçÏû•", spanish: "mueble de cajones" },
  { korean: "ÏãùÌÉÅ", spanish: "mesa de comedor" },
  { korean: "Ï±ÖÏû•", spanish: "estanter√≠a de libros" },
  { korean: "ÏÑ†Î∞ò", spanish: "repisas o estantes de repisas" },
  { korean: "Ïª§Ìäº", spanish: "cortina" },
  { korean: "Ïπ¥Ìé´", spanish: "alfombra" },
  { korean: "Ï°∞Î™Ö", spanish: "luz (general)" },
  { korean: "ÎÉâÏû•Í≥†", spanish: "nevera" },
  { korean: "Í∞ÄÏä§Î†àÏù∏ÏßÄ", spanish: "cocina de gas" },
  { korean: "Ïò§Î∏ê", spanish: "horno" },
  { korean: "Ï†ÑÏûêÎ†àÏù∏ÏßÄ", spanish: "microondas" },
  { korean: "ÏÑ∏ÌÉÅÍ∏∞", spanish: "lavadora" },
  { korean: "Ï≤≠ÏÜåÍ∏∞", spanish: "aspiradora" },
  { korean: "ÏóêÏñ¥Ïª®", spanish: "aire acondicionado" },
  { korean: "ÎÇúÎ°ú", spanish: "estufa" },
  { korean: "Î≤ΩÏßÄ", spanish: "papel de la pared" },
  { korean: "Ï∞ΩÌãÄ", spanish: "marco de la ventana" },
  { korean: "Ïó¥Ïá†", spanish: "llaves" },
  { korean: "ÏàòÎèÑÍº≠ÏßÄ", spanish: "grifo" },
  { korean: "ÏÑ∏Î©¥ÎåÄ", spanish: "lavabo" },
  { korean: "Í±∞Ïö∏", spanish: "espejo" },
  { korean: "Ïû•ÏãùÌíà", spanish: "decoraci√≥n" },
  { korean: "ÏãùÍ∏∞", spanish: "vajilla" },
  { korean: "Ïπ®Íµ¨", spanish: "edred√≥n, manta, almohada (cosas para dormir)" },
  { korean: "Ìú¥ÏßÄÌÜµ", spanish: "papelera" },
  { korean: "ÏãùÍ∏∞ÏÑ∏Ï≤ôÍ∏∞", spanish: "lavavajillas" }
];

const KoreanVocabularyGame: React.FC = () => {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [password, setPassword] = useState('');
  const [gameWords, setGameWords] = useState<Word[]>([]);
  const [currentWords, setCurrentWords] = useState<Word[]>([]);
  const [currentWord, setCurrentWord] = useState<Word | null>(null);
  const [score, setScore] = useState(0);
  const [gameStarted, setGameStarted] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);

  const correctPassword = "bts";

  const handleLogin = () => {
    if (password === correctPassword) {
      setIsLoggedIn(true);
      startGame();
    } else {
      alert("Contrase√±a incorrecta.");
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter') {
      handleLogin();
    }
  };

  const startGame = () => {
    setGameWords([...words]);
    setScore(0);
    setGameStarted(true);
    generateWords([...words]);
  };

  const generateWords = (availableWords: Word[]) => {
    if (availableWords.length === 0) {
      endGame();
      return;
    }

    const shuffled = [...availableWords].sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, Math.min(5, shuffled.length));
    setCurrentWords(selected);
    setCurrentWord(selected[Math.floor(Math.random() * selected.length)]);
    setSelectedAnswer(null);
  };

  const checkWord = (selectedWord: string) => {
    setSelectedAnswer(selectedWord);
    
    if (selectedWord === currentWord?.korean) {
      setScore(prev => prev + 1);
      
      // Reproducir audio
      const audio = new Audio(`audio/${selectedWord}.mp3`);
      audio.play().catch(() => {
        // Manejo silencioso si el audio no est√° disponible
      });

      // Eliminar palabra correcta
      const newGameWords = gameWords.filter(word => word.korean !== currentWord.korean);
      setGameWords(newGameWords);
      
      setTimeout(() => generateWords(newGameWords), 1000);
    } else {
      setTimeout(() => generateWords(gameWords), 1000);
    }
  };

  const endGame = () => {
    const incorrectCount = words.length - score;
    alert(`¬°Felicidades! Has repasado todas las palabras.\nTuviste ${score} aciertos y ${incorrectCount} fallos.`);
    setIsLoggedIn(false);
    setGameStarted(false);
    setPassword('');
  };

  if (!isLoggedIn) {
    return (
      <div 
        className="min-h-screen flex items-center justify-center bg-cover bg-center bg-no-repeat"
        style={{ backgroundImage: "url('fondo/fondo2.png')" }}
      >
        <div className="w-full max-w-md mx-4">
          <div className="bg-white rounded-xl shadow-2xl border-2 border-gray-200 p-8">
            <div className="text-center space-y-6">
              <div className="space-y-2">
                <h1 className="text-2xl font-bold text-gray-800">
                  ¬°VOCABULARIO SOBRE HOGAR CON BTS!
                </h1>
                <div className="w-16 h-1 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto rounded-full"></div>
              </div>
              
              <div className="space-y-4">
                <p className="text-gray-600 font-medium">Introduce la contrase√±a:</p>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Contrase√±a"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors duration-200 text-center"
                />
                <button
                  onClick={handleLogin}
                  className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-3 px-6 rounded-lg hover:from-purple-600 hover:to-pink-600 transform hover:scale-105 transition-all duration-200 shadow-lg"
                >
                  ENTRAR
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div 
      className="min-h-screen flex items-center justify-center bg-cover bg-center bg-no-repeat p-4"
      style={{ backgroundImage: "url('fondo/fondo2.png')" }}
    >
      <div className="w-full max-w-2xl">
        <div className="bg-white rounded-xl shadow-2xl border-2 border-gray-200 p-6 space-y-6">
          {/* Header con puntuaci√≥n */}
          <div className="text-center">
            <div className="inline-flex items-center px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full font-bold text-lg shadow-lg">
              <span className="mr-2">üèÜ</span>
              Puntuaci√≥n: {score}
            </div>
          </div>

          {/* Palabra a traducir */}
          {currentWord && (
            <div className="text-center space-y-4">
              <div className="bg-gradient-to-r from-gray-50 to-gray-100 border-2 border-gray-200 rounded-xl p-6">
                <h2 className="text-3xl font-bold text-gray-800 mb-2">
                  {currentWord.spanish}
                </h2>
                <div className="text-lg text-gray-600 font-medium">
                  Ïù¥ Îã®Ïñ¥Îäî <span className="text-purple-600 font-bold">________</span> ÏûÖÎãàÎã§
                </div>
              </div>
              
              <div className="text-lg font-semibold text-gray-700">
                ¬øQu√© palabra es?
              </div>
            </div>
          )}

          {/* Opciones de respuesta */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            {currentWords.map((word, index) => {
              let buttonClass = "w-full p-4 border-2 border-gray-200 rounded-lg font-medium text-lg transition-all duration-200 hover:scale-105 hover:shadow-md ";
              
              if (selectedAnswer === word.korean) {
                if (word.korean === currentWord?.korean) {
                  buttonClass += "bg-green-500 text-white border-green-500 shadow-lg";
                } else {
                  buttonClass += "bg-red-500 text-white border-red-500 shadow-lg";
                }
              } else {
                buttonClass += "bg-white text-gray-800 hover:bg-gray-50 hover:border-purple-300";
              }

              return (
                <button
                  key={index}
                  onClick={() => checkWord(word.korean)}
                  disabled={selectedAnswer !== null}
                  className={buttonClass}
                >
                  {word.korean}
                </button>
              );
            })}
          </div>

          {/* Indicador de progreso */}
          <div className="bg-gray-200 rounded-full h-2 overflow-hidden">
            <div 
              className="bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-300 ease-out"
              style={{ width: `${(score / words.length) * 100}%` }}
            ></div>
          </div>
          
          <div className="text-center text-sm text-gray-600">
            Progreso: {score} / {words.length} palabras
          </div>
        </div>
      </div>
    </div>
  );
};

export default KoreanVocabularyGame;
